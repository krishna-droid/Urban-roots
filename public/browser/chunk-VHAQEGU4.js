import{a as G}from"./chunk-6UOEEPEF.js";import{b as H,c as N,f as W,n as $}from"./chunk-3XLOQSKB.js";import{a as q}from"./chunk-KD2IJGWA.js";import{e as U,f as B,h as F,i as A,q as L,t as j,w as z}from"./chunk-PGUYAPD4.js";import{$b as T,Ab as o,Bb as r,Cb as g,Db as E,Eb as P,Gb as f,Lb as v,Nb as a,Vb as p,Wb as x,Yb as k,Za as h,Zb as I,_a as S,_b as M,bc as V,db as l,eb as b,fc as C,gc as w,h as R,na as O,tb as u,vb as d,wa as m,xa as _}from"./chunk-7ZC2CAVG.js";function K(c,t){c&1&&(o(0,"div",5),p(1,"Loading topic details..."),r())}function Q(c,t){if(c&1){let e=f();o(0,"button",28),v("click",function(){m(e);let n=a().$implicit,s=a(2);return _(s.deleteReply(n.id))}),p(1," Delete "),r()}}function X(c,t){if(c&1){let e=f();o(0,"button",28),v("click",function(){m(e);let n=a().$implicit,s=a(4);return _(s.deleteReply(n.id))}),p(1," Delete "),r()}}function Y(c,t){if(c&1){let e=f();E(0),o(1,"div",30)(2,"div",18),g(3,"img",19),r(),o(4,"div")(5,"p",20),p(6),r(),o(7,"p",21),p(8),C(9,"date"),r(),g(10,"div",22),o(11,"div",23),u(12,X,2,0,"button",24),o(13,"button",25),v("click",function(){let n=m(e).$implicit,s=a(4);return _(s.replyToReply(n))}),p(14," Reply "),r()()()(),P()}if(c&2){let e=t.$implicit,i=a(4);l(3),d("src",e.userImageUrl||"path/to/default-profile-image.jpg",S),l(3),x(e.username),l(2),x(w(9,5,e.createdOn,"medium")),l(2),d("innerHTML",e.content,h),l(2),d("ngIf",i.canDeleteReply(e))}}function Z(c,t){if(c&1&&(o(0,"div",29),u(1,Y,15,8,"ng-container",13),r()),c&2){let e=a().$implicit;l(),d("ngForOf",e.replies)}}function ee(c,t){if(c&1){let e=f();o(0,"div",31)(1,"textarea",14),T("ngModelChange",function(n){m(e);let s=a(3);return M(s.newReplyContent,n)||(s.newReplyContent=n),_(n)}),r(),o(2,"button",15),v("click",function(){m(e);let n=a().$implicit,s=a(2);return _(s.addReply(n.id))}),p(3," Add Reply "),r()()}if(c&2){let e=a(3);l(),I("ngModel",e.newReplyContent)}}function te(c,t){if(c&1){let e=f();o(0,"div")(1,"div",17)(2,"div",18),g(3,"img",19),r(),o(4,"div")(5,"p",20),p(6),r(),o(7,"p",21),p(8),C(9,"date"),r(),g(10,"div",22),o(11,"div",23),u(12,Q,2,0,"button",24),o(13,"button",25),v("click",function(){let n=m(e).$implicit,s=a(2);return _(s.replyToReply(n))}),p(14," Reply "),r()(),u(15,Z,2,1,"div",26)(16,ee,4,1,"div",27),r()()()}if(c&2){let e=t.$implicit,i=a(2);l(3),d("src",e.userImageUrl||"path/to/default-profile-image.jpg",S),l(3),x(e.username),l(2),x(w(9,7,e.createdOn,"medium")),l(2),d("innerHTML",e.content,h),l(2),d("ngIf",i.canDeleteReply(e)),l(3),d("ngIf",e.replies&&e.replies.length>0),l(),d("ngIf",i.isReplyingTo===e.id)}}function ie(c,t){if(c&1){let e=f();o(0,"div",6)(1,"div",7)(2,"h2",8),p(3),r(),o(4,"p",9),p(5),C(6,"date"),r(),g(7,"div",10),o(8,"div",11)(9,"h3",12),p(10,"Replies"),r(),u(11,te,17,10,"div",13),o(12,"div",11)(13,"textarea",14),T("ngModelChange",function(n){m(e);let s=a();return M(s.newReplyContent,n)||(s.newReplyContent=n),_(n)}),r(),o(14,"button",15),v("click",function(){m(e);let n=a();return _(n.addReply())}),p(15," Add Reply "),r()()(),o(16,"button",16),p(17," Back to Forum "),r()()()}if(c&2){let e=a();l(3),x(e.topic.title),l(2),k("Created by: ",e.topic.createdByUsername," on ",w(6,6,e.topic.createdOn,"medium"),""),l(2),d("innerHTML",e.topic.content,h),l(4),d("ngForOf",e.topic.replies),l(2),I("ngModel",e.newReplyContent)}}var J=class c{constructor(t,e,i){this.route=t;this.forumService=e;this.authService=i}topic=null;newReplyContent="";isReplyingTo=null;ngOnInit(){this.route.paramMap.subscribe(t=>{let e=t.get("id");e&&this.fetchTopicDetails(e)})}fetchTopicDetails(t){return R(this,null,function*(){try{this.topic=yield this.forumService.getTopicById(t),console.log("topic.content",this.topic.content)}catch(e){console.error("Error fetching topic details:",e)}})}canDeleteReply(t){let e=this.authService.getUserId();return t.userId===e||this.topic.createdBy===e}deleteReply(t){confirm("Are you sure you want to delete this reply?")&&this.forumService.deleteReply(this.topic.id,t).then(()=>{this.fetchTopicDetails(this.topic.id)}).catch(e=>{console.error("Error deleting reply:",e)})}replyToReply(t){this.isReplyingTo=t.id,this.newReplyContent=""}addReply(t=null){return R(this,null,function*(){let e=this.authService.getUserId(),i=yield this.authService.getCurrentUser(),n=i?.displayName||"Anonymous",s=i?.photoURL||"path/to/default-profile-image.jpg",D={id:this.generateRandomId(),userId:e,username:n,userImageUrl:s,content:this.newReplyContent,createdOn:new Date().toISOString().slice(0,16),replies:[]};if(this.topic.replies||(this.topic.replies=[]),t){let y=this.findReplyById(this.topic.replies,t);y&&y.replies.push(D)}else this.topic.replies.push(D);this.newReplyContent="",this.isReplyingTo=null,this.forumService.updateTopic(this.topic.id,this.topic).then(()=>{}).catch(y=>{console.error("Error adding reply:",y)})})}findReplyById(t,e){for(let i of t){if(i.id===e)return i;if(i.replies&&i.replies.length>0){let n=this.findReplyById(i.replies,e);if(n)return n}}return null}generateRandomId(){let t=new Date().getTime(),e=Math.random().toString(36).substring(2,15);return`${t}_${e}`}static \u0275fac=function(e){return new(e||c)(b(L),b(G),b(q))};static \u0275cmp=O({type:c,selectors:[["app-discussion"]],standalone:!0,features:[V],decls:5,vars:2,consts:[[1,"container","mx-auto","p-8","bg-base-100","rounded-lg","max-w-3xl"],["onclick","window.history.back()",1,"mt-4","bg-base-300","hover:bg-base-400","text-base-content","font-bold","py-2","px-2","rounded","flex","items-center"],[1,"fas","fa-arrow-left"],["class","text-base-content text-center py-8",4,"ngIf"],["class","bg-base-100 rounded-lg shadow-md overflow-hidden mx-auto max-w-3xl",4,"ngIf"],[1,"text-base-content","text-center","py-8"],[1,"bg-base-100","rounded-lg","shadow-md","overflow-hidden","mx-auto","max-w-3xl"],[1,"p-10"],[1,"text-3xl","font-extrabold","text-base-content","mb-4"],[1,"text-base-content","mb-2"],[1,"topic-content",3,"innerHTML"],[1,"mt-6"],[1,"text-xl","font-bold","text-base-content","mb-3"],[4,"ngFor","ngForOf"],["rows","3",1,"w-full","p-2","border","rounded-md",3,"ngModelChange","ngModel"],[1,"bg-primary","hover:bg-primary-focus","text-base-100","font-bold","py-2","px-4","rounded","mt-2",3,"click"],["routerLink","/forum/overview",1,"mt-4","bg-base-300","hover:bg-base-400","text-base-content","font-bold","py-2","px-4","rounded"],[1,"flex","items-start","mb-4","reply"],[1,"w-12","h-12","rounded-full","overflow-hidden","mr-3"],["alt","User Image",1,"w-full","h-full","object-cover",3,"src"],[1,"font-semibold"],[1,"text-base-content","text-sm","mb-2"],[3,"innerHTML"],[1,"flex","justify-end","mt-2"],["class","text-error hover:underline",3,"click",4,"ngIf"],[1,"text-primary","hover:underline","ml-2",3,"click"],["class","ml-6 mt-4",4,"ngIf"],["class","mt-4",4,"ngIf"],[1,"text-error","hover:underline",3,"click"],[1,"ml-6","mt-4"],[1,"flex","items-start","mb-4","sub-reply"],[1,"mt-4"]],template:function(e,i){e&1&&(o(0,"div",0)(1,"button",1),g(2,"i",2),r(),u(3,K,2,0,"div",3)(4,ie,18,9,"div",4),r()),e&2&&(l(3),d("ngIf",!i.topic),l(),d("ngIf",i.topic))},dependencies:[$,H,N,W,A,U,B,F,j,z],styles:[".topic-content[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin-bottom:1rem}.topic-content[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:last-child{margin-bottom:0}.topic-content[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:2.5rem;font-weight:700;margin-bottom:1rem}.topic-content[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:2rem;font-weight:700;margin-bottom:.75rem}.topic-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1rem;line-height:1.5;margin-bottom:1rem}.topic-content[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:100%;height:auto;display:block;margin-bottom:1rem}.topic-content[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%], .topic-content[_ngcontent-%COMP%]   ol[_ngcontent-%COMP%]{list-style-type:disc;padding-left:1.5rem;margin-bottom:1rem}.topic-content[_ngcontent-%COMP%]   blockquote[_ngcontent-%COMP%]{border-left:4px solid #ccc;padding-left:1rem;margin-bottom:1rem;font-style:italic}.reply[_ngcontent-%COMP%]{border-left:2px solid #ccc;padding-left:1rem}.sub-reply[_ngcontent-%COMP%]{margin-left:2rem;border-left:1px solid #eee}"]})};export{J as DiscussionComponent};
