import{Ab as B,Cb as z,Da as U,Eb as X,Fb as J,Hb as j,Ib as V,kb as H,nb as Q,qb as R,rb as $,sb as G,tb as K,ub as F,wb as T,zb as k}from"./chunk-PGUYAPD4.js";import{a as I,d as ee,da as O,f as re,h as l,ia as L}from"./chunk-7ZC2CAVG.js";var Y=ee((S,W)=>{"use strict";(function(i,o){typeof S=="object"&&typeof W<"u"?o(S):typeof define=="function"&&define.amd?define(["exports"],o):o((i=i||self)["geofire-common"]={})})(S,function(i){"use strict";var o="0123456789bcdefghjkmnpqrstuvwxyz",n=40007860,t=110574,u=6378137,f=.00669447819799;function b(e){return Math.log(e)/Math.log(2)}function E(e){var r;if(Array.isArray(e))if(e.length!==2)r="expected array of length 2, got length "+e.length;else{var a=e[0],s=e[1];typeof a!="number"||isNaN(a)?r="latitude must be a number":a<-90||a>90?r="latitude must be within the range [-90, 90]":typeof s!="number"||isNaN(s)?r="longitude must be a number":(s<-180||s>180)&&(r="longitude must be within the range [-180, 180]")}else r="location must be an array";if(r!==void 0)throw new Error("Invalid GeoFire location '"+e+"': "+r)}function v(e){var r;if(typeof e!="string")r="geohash must be a string";else if(e.length===0)r="geohash cannot be the empty string";else for(var a=0,s=e;a<s.length;a++){var c=s[a];o.indexOf(c)===-1&&(r="geohash cannot contain '"+c+"'")}if(r!==void 0)throw new Error("Invalid GeoFire geohash '"+e+"': "+r)}function m(e){if(typeof e!="number"||isNaN(e))throw new Error("Error: degrees must be a number");return e*Math.PI/180}function D(e,r){if(r===void 0&&(r=10),E(e),r!==void 0){if(typeof r!="number"||isNaN(r))throw new Error("precision must be a number");if(r<=0)throw new Error("precision must be greater than 0");if(r>22)throw new Error("precision cannot be greater than 22");if(Math.round(r)!==r)throw new Error("precision must be an integer")}for(var a={min:-90,max:90},s={min:-180,max:180},c="",d=0,g=0,h=1;c.length<r;){var A=h?e[1]:e[0],x=h?s:a,C=(x.min+x.max)/2;A>C?(d=1+(d<<1),x.min=C):(d=0+(d<<1),x.max=C),h=!h,g<4?g++:(g=0,c+=o[d],d=0)}return c}function M(e,r){var a=m(r),s=Math.cos(a)*u*Math.PI/180*(1/Math.sqrt(1-f*Math.sin(a)*Math.sin(a)));return s<1e-12?e>0?360:0:Math.min(360,e/s)}function w(e,r){var a=M(e,r);return Math.abs(a)>1e-6?Math.max(1,b(360/a)):1}function y(e){return Math.min(b(20003930/e),110)}function p(e){if(e<=180&&e>=-180)return e;var r=e+180;return r>0?r%360-180:180- -r%360}function P(e,r){var a=r/t,s=Math.min(90,e[0]+a),c=Math.max(-90,e[0]-a),d=2*Math.floor(y(r)),g=2*Math.floor(w(r,s))-1,h=2*Math.floor(w(r,c))-1;return Math.min(d,g,h,110)}function N(e,r){var a=r/t,s=Math.min(90,e[0]+a),c=Math.max(-90,e[0]-a),d=M(r,s),g=M(r,c),h=Math.max(d,g);return[[e[0],e[1]],[e[0],p(e[1]-h)],[e[0],p(e[1]+h)],[s,e[1]],[s,p(e[1]-h)],[s,p(e[1]+h)],[c,e[1]],[c,p(e[1]-h)],[c,p(e[1]+h)]]}function q(e,r){v(e);var a=Math.ceil(r/5);if(e.length<a)return[e,e+"~"];var s=(e=e.substring(0,a)).substring(0,e.length-1),c=o.indexOf(e.charAt(e.length-1)),d=5-(r-5*s.length),g=c>>d<<d,h=g+(1<<d);return h>31?[s+o[g],s+"~"]:[s+o[g],s+o[h]]}i.BASE32=o,i.BITS_PER_CHAR=5,i.E2=f,i.EARTH_EQ_RADIUS=u,i.EARTH_MERI_CIRCUMFERENCE=n,i.EPSILON=1e-12,i.GEOHASH_PRECISION=10,i.MAXIMUM_BITS_PRECISION=110,i.METERS_PER_DEGREE_LATITUDE=t,i.boundingBoxBits=P,i.boundingBoxCoordinates=N,i.degreesToRadians=m,i.distanceBetween=function(e,r){E(e),E(r);var a=m(r[0]-e[0]),s=m(r[1]-e[1]),c=Math.sin(a/2)*Math.sin(a/2)+Math.cos(m(e[0]))*Math.cos(m(r[0]))*Math.sin(s/2)*Math.sin(s/2);return 6371*(2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)))},i.geohashForLocation=D,i.geohashQuery=q,i.geohashQueryBounds=function(e,r){E(e);var a=Math.max(1,P(e,r)),s=Math.ceil(a/5),c=N(e,r).map(function(d){return q(D(d,s),a)});return c.filter(function(d,g){return!c.some(function(h,A){return g>A&&d[0]===h[0]&&d[1]===h[1]})})},i.latitudeBitsForResolution=y,i.longitudeBitsForResolution=w,i.metersToLongitudeDegrees=M,i.validateGeohash=v,i.validateKey=function(e){var r;if(typeof e!="string"?r="key must be a string":e.length===0?r="key cannot be the empty string":11+e.length>755?r="key is too long to be stored in Firebase":/[\[\].#$\/\u0000-\u001F\u007F]/.test(e)&&(r="key cannot contain any of the following characters: . # $ ] [ /"),r!==void 0)throw new Error("Invalid GeoFire key '"+e+"': "+r)},i.validateLocation=E,i.wrapLongitude=p,Object.defineProperty(i,"__esModule",{value:!0})})});var _=re(Y());var Z=class i{constructor(o,n){this.firestore=o;this.storage=n}createGarden(o){return l(this,null,function*(){try{let n=R(this.firestore,"gardens"),t=yield Q(n,o);return console.log("Garden added with ID:",t.id),o.images&&o.images.length>0&&(yield this.updateGardenImages(t.id,o.images)),t.id}catch(n){throw console.error("Error creating garden:",n),n}})}uploadFile(o){return l(this,null,function*(){let n=`garden_images/${new Date().getTime()}_${o.name}`,t=j(this.storage,n);try{return yield V(t,o),yield J(t)}catch(u){throw console.error("Error uploading file:",u),u}})}deleteImage(o){return l(this,null,function*(){try{let n=j(this.storage,o);yield X(n),console.log("Image deleted successfully:",o)}catch(n){throw console.error("Error deleting image:",n),n}})}getAllGardens(){return l(this,null,function*(){try{let o=R(this.firestore,"gardens"),n=yield F(o),t=[];return n.forEach(u=>{let f=u.data();t.push(I({id:u.id},f))}),console.log("gardens",t),t}catch(o){return console.error("Error fetching all gardens:",o),[]}})}getNearbyGardens(o,n,t){return l(this,null,function*(){let u=new U(o,n),f="geohash",b=[u.latitude,u.longitude];console.log("lat",o),console.log("lon",n),console.log("centerCoordinates",b),console.log("center",u);let E=t*1e3,v=(0,_.geohashQueryBounds)(b,E);console.log("bounds",v);let m=[];for(let w of v){let y=T(R(this.firestore,"gardens"),B(f,">=",w[0]),B(f,"<=",w[1]));m.push(F(y))}let D=yield Promise.all(m),M=[];for(let w of D)for(let y of w.docs){let p=y.get("location").latitude,P=y.get("location").longitude;(0,_.distanceBetween)([p,P],[u.latitude,u.longitude])<=t&&M.push(I({id:y.id},y.data()))}return{matchingDocs:M,bounds:v}})}getGardensByUserId(o){return l(this,null,function*(){try{let n=T(R(this.firestore,"gardens"),B("userId","==",o)),t=yield F(n),u=[];return t.forEach(f=>{let b=f.data();u.push(I({id:f.id},b))}),u}catch(n){return console.error("Error fetching gardens by user ID:",n),[]}})}deleteGarden(o){return l(this,null,function*(){try{let n=G(this.firestore,"gardens",o);yield $(n),console.log("Garden deleted successfully:",o)}catch(n){throw console.error("Error deleting garden:",n),n}})}getGardenById(o){return l(this,null,function*(){try{let n=G(this.firestore,"gardens",o),t=yield K(n);if(t.exists())return I({id:t.id},t.data());throw console.error("Garden not found with ID:",o),new Error("Garden not found")}catch(n){throw console.error("Error fetching garden by ID:",n),n}})}updateGarden(o,n){return l(this,null,function*(){try{let t=G(this.firestore,"gardens",o);yield k(t,n),console.log("Garden updated successfully:",o)}catch(t){throw console.error("Error updating garden:",t),t}})}updateGardenImages(o,n){return l(this,null,function*(){try{let t=G(this.firestore,"gardens",o);yield k(t,{images:n})}catch(t){throw console.error("Error updating garden images:",t),t}})}static \u0275fac=function(n){return new(n||i)(L(H),L(z))};static \u0275prov=O({token:i,factory:i.\u0275fac,providedIn:"root"})};export{Y as a,Z as b};
