import{a as $}from"./chunk-K6MDAUMQ.js";import{a as ne}from"./chunk-NGMGY73J.js";import{a as Y,b as Z}from"./chunk-QZIFPMOZ.js";import{a as te}from"./chunk-IHOIJJLM.js";import{b as R,c as A,d as D,e as j,f as B,g as z,j as G,k as q,l as H,m as J,n as K}from"./chunk-3XLOQSKB.js";import{a as X}from"./chunk-KD2IJGWA.js";import{Da as Q,f as O,i as U,q as F,s as W,w as N}from"./chunk-PGUYAPD4.js";import{$b as b,Ab as i,Bb as o,Cb as y,Gb as w,Lb as C,Nb as u,Ub as I,Vb as d,Wb as L,Xb as P,Yb as V,Zb as f,_a as T,_b as h,bc as k,db as l,eb as x,f as S,h as E,na as M,tb as _,vb as v,wa as m,xa as p}from"./chunk-7ZC2CAVG.js";var c=S(te());var xe=S(ne());function ie(s,t){if(s&1){let e=w();i(0,"div",22),y(1,"img",23),i(2,"button",24),C("click",function(){m(e);let a=u();return p(a.removeImage())}),y(3,"i",25),o()()}if(s&2){let e=u();l(),v("src",e.getPreviewUrl(e.selectedImageFile),T)}}function oe(s,t){if(s&1&&(i(0,"div")(1,"p",29),d(2),o()()),s&2){let e=u(2);l(2),V("Selected Location: ",e.selectedLocation.lat,", ",e.selectedLocation.lng,"")}}function re(s,t){if(s&1&&(i(0,"div",6)(1,"label",26),d(2,"Location"),o(),y(3,"div",27),_(4,oe,3,2,"div",28),o()),s&2){let e=u();l(4),v("ngIf",e.selectedLocation)}}function ae(s,t){if(s&1){let e=w();i(0,"div",6)(1,"label",30),d(2,"Location (Text)"),o(),i(3,"input",31),b("ngModelChange",function(a){m(e);let g=u();return h(g.event.locationText,a)||(g.event.locationText=a),p(a)}),o()()}if(s&2){let e=u();l(3),f("ngModel",e.event.locationText)}}var ee=class s{constructor(t,e,n,a){this.eventService=t;this.authService=e;this.router=n;this.route=a}map;searchControl;selectedLocation=null;event={name:"",imageUrl:"",dateTime:"",eventType:"offline",location:null,locationText:"",description:""};eventId=null;isEditing=!1;selectedImageFile=null;existingImageUrl;ngAfterViewInit(){console.log("Map container element:",document.getElementById("map")),this.event.eventType==="offline"&&this.initializeMap()}ngOnInit(){this.route.paramMap.subscribe(t=>{this.eventId=t.get("id"),this.eventId?(this.isEditing=!0,this.fetchEventDetails()):this.event.dateTime=new Date().toISOString().slice(0,16)}),c.Icon.Default.imagePath="assets/"}initializeMap(){this.map=c.map("map").setView([17.385,78.4867],13),c.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"\xA9 OpenStreetMap contributors"}).addTo(this.map);let t=new Z;this.searchControl=new Y({provider:t}),this.map.addControl(this.searchControl),this.map.on("click",e=>{this.setSelectedLocation(e.latlng)}),this.map.on("geosearch/showlocation",e=>{this.setSelectedLocation(e.location.latlng)})}searchLocation(t){let e=t.target.value;this.searchControl.search(e)}setSelectedLocation(t){this.selectedLocation={lat:t.lat,lng:t.lng},this.map.eachLayer(n=>{n instanceof c.Marker&&this.map.removeLayer(n)}),c.marker(t).addTo(this.map).bindPopup("Selected Location").openPopup(),this.event.location=new Q(t.lat,t.lng)}onEventTypeChange(){this.event.eventType==="offline"?(this.selectedLocation=null,this.event.location=null,this.event.locationText="",this.map||setTimeout(()=>{this.initializeMap()},0)):(this.map&&(this.map.remove(),this.map=null),this.selectedLocation=null,this.event.location=null,this.event.locationText="")}fetchEventDetails(){return E(this,null,function*(){if(this.eventId)try{this.event=yield this.eventService.getEventById(this.eventId),this.event.eventType==="offline"&&this.event.location&&(this.map.setView([this.event.location.latitude,this.event.location.longitude],13),this.setSelectedLocation(c.latLng(this.event.location.latitude,this.event.location.longitude)))}catch(t){console.error("Error fetching event details:",t)}})}submitEvent(){return E(this,null,function*(){let t=yield this.authService.getCurrentUser();if(t)this.event.createdBy=t.uid;else{alert("user not found");return}if(this.selectedImageFile)try{this.event.imageUrl=yield this.eventService.uploadEventImage(this.selectedImageFile)}catch(e){console.error("Error uploading event image:",e)}this.isEditing?this.eventService.updateEvent(this.eventId,this.event).then(()=>{alert("Event updated successfully!"),this.router.navigate(["/event/overview"])}).catch(e=>{console.error("Error updating event:",e)}):this.eventService.createEvent(this.event).then(()=>{alert("Event created successfully!"),this.router.navigate(["/event/overview"])}).catch(e=>{console.error("Error creating event:",e)})})}onImageSelected(t){this.selectedImageFile=t.target.files[0],this.existingImageUrl=null}removeImage(){this.selectedImageFile=null,this.existingImageUrl=null,this.isEditing&&this.event.imageUrl&&this.eventService.deleteEventImage(this.event.imageUrl).catch(t=>{console.error("Error deleting event image:",t)})}getPreviewUrl(t){return t?URL.createObjectURL(t):this.existingImageUrl?this.existingImageUrl:null}static \u0275fac=function(e){return new(e||s)(x($),x(X),x(W),x(F))};static \u0275cmp=M({type:s,selectors:[["app-create"]],standalone:!0,features:[k],decls:36,vars:10,consts:[["eventForm","ngForm"],[1,"container","mx-auto","p-8","bg-base-100","rounded-lg","max-w-3xl"],["onclick","window.history.back()",1,"mt-4","bg-base-300","hover:bg-base-400","text-base-content","font-bold","py-2","px-2","rounded","flex","items-center"],[1,"fas","fa-arrow-left"],[1,"text-2xl","font-bold","mb-4"],[3,"ngSubmit"],[1,"mb-4"],["for","name",1,"block","text-sm","font-medium","text-base-content"],["type","text","id","name","name","name","required","",1,"mt-1","p-2","border","rounded-md","w-full",3,"ngModelChange","ngModel"],["for","image",1,"block","text-lg","font-semibold","text-base-content"],["class","relative mt-2",4,"ngIf"],["type","file","id","image","name","image",1,"mt-2","p-2","border","border-base-300","rounded-lg","w-full","focus:ring","focus:ring-primary",3,"change"],["for","dateTime",1,"block","text-sm","font-medium","text-base-content"],["type","datetime-local","id","dateTime","name","dateTime","required","",1,"mt-1","p-2","border","rounded-md","w-full",3,"ngModelChange","ngModel"],["for","eventType",1,"block","text-sm","font-medium","text-base-content"],["id","eventType","name","eventType",1,"mt-1","p-2","border","rounded-md","w-full",3,"ngModelChange","change","ngModel"],["value","online"],["value","offline"],["class","mb-4",4,"ngIf"],["for","description",1,"block","text-sm","font-medium","text-base-content"],["id","description","name","description","rows","4",1,"mt-1","p-2","border","rounded-md","w-full",3,"ngModelChange","ngModel"],["type","submit",1,"bg-success","hover:bg-success-dark","text-base-100","font-bold","py-2","px-4","rounded",3,"disabled"],[1,"relative","mt-2"],["alt","Event Image Preview",1,"h-48","w-full","object-cover","rounded-lg","shadow-lg",3,"src"],["type","button",1,"absolute","top-0","right-0","m-2","bg-error","text-base-100","rounded-full","p-1","hover:bg-error-dark","transition","duration-300",3,"click"],[1,"fas","fa-times"],[1,"block","text-sm","font-medium","text-base-content"],["id","map",1,"h-64","rounded-lg","overflow-hidden","border","border-base-300","mb-4"],[4,"ngIf"],[1,"text-base-content"],["for","locationText",1,"block","text-sm","font-medium","text-base-content"],["type","text","id","locationText","name","locationText",1,"mt-1","p-2","border","rounded-md","w-full",3,"ngModelChange","ngModel"]],template:function(e,n){if(e&1){let a=w();i(0,"div",1)(1,"button",2),y(2,"i",3),o(),i(3,"h1",4),d(4),o(),i(5,"form",5,0),C("ngSubmit",function(){return m(a),p(n.submitEvent())}),i(7,"div",6)(8,"label",7),d(9,"Event Name"),o(),i(10,"input",8),b("ngModelChange",function(r){return m(a),h(n.event.name,r)||(n.event.name=r),p(r)}),o()(),i(11,"div",6)(12,"label",9),d(13,"Image"),o(),_(14,ie,4,1,"div",10),i(15,"input",11),C("change",function(r){return m(a),p(n.onImageSelected(r))}),o()(),i(16,"div",6)(17,"label",12),d(18,"Date and Time"),o(),i(19,"input",13),b("ngModelChange",function(r){return m(a),h(n.event.dateTime,r)||(n.event.dateTime=r),p(r)}),o()(),i(20,"div",6)(21,"label",14),d(22,"Event Type"),o(),i(23,"select",15),b("ngModelChange",function(r){return m(a),h(n.event.eventType,r)||(n.event.eventType=r),p(r)}),C("change",function(){return m(a),p(n.onEventTypeChange())}),i(24,"option",16),d(25,"Online"),o(),i(26,"option",17),d(27,"Offline"),o()()(),_(28,re,5,1,"div",18)(29,ae,4,1,"div",18),i(30,"div",6)(31,"label",19),d(32,"Description"),o(),i(33,"textarea",20),b("ngModelChange",function(r){return m(a),h(n.event.description,r)||(n.event.description=r),p(r)}),o()(),i(34,"button",21),d(35),o()()()}if(e&2){let a=I(6);l(4),L(n.isEditing?"Edit Event":"Create New Event"),l(6),f("ngModel",n.event.name),l(4),v("ngIf",n.selectedImageFile||n.existingImageUrl),l(5),f("ngModel",n.event.dateTime),l(4),f("ngModel",n.event.eventType),l(5),v("ngIf",n.event.eventType==="offline"),l(),v("ngIf",n.event.eventType==="offline"),l(4),f("ngModel",n.event.description),l(),v("disabled",!a.form.valid),l(),P(" ",n.isEditing?"Update Event":"Create Event"," ")}},dependencies:[K,z,q,H,R,G,A,D,J,B,j,U,O,N],styles:[".dashboard-container[_ngcontent-%COMP%]{display:flex;height:100vh}.sidebar[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:200px;background-color:#f4f4f4;padding:20px;box-shadow:2px 0 5px #0000001a}.sidebar[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:10px 0;padding:10px;font-size:16px;cursor:pointer;background-color:#007bff;color:#fff;border:none;border-radius:5px}.main-content[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;padding:20px;position:relative}.bottom-buttons[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:20px}.bottom-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1;margin:0 10px;padding:10px;font-size:16px;cursor:pointer;background-color:#28a745;color:#fff;border:none;border-radius:5px}.nearby-filter[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.nearby-filter[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1;margin:0 10px;padding:10px;font-size:16px;cursor:pointer;background-color:#17a2b8;color:#fff;border:none;border-radius:5px}.map-container[_ngcontent-%COMP%]{height:55%!important;width:100%;margin:0 0 20px;padding:0;border:1px solid #ccc}.custom-garden-icon[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;box-shadow:0 2px 5px #0003}"]})};export{ee as CreateEventComponent};
