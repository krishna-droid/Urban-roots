import{a as C}from"./chunk-IHOIJJLM.js";import{f as L}from"./chunk-7ZC2CAVG.js";var l=L(C());function p(){return p=Object.assign?Object.assign.bind():function(t){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},p.apply(this,arguments)}function R(t,n){t.prototype=Object.create(n.prototype),t.prototype.constructor=t,g(t,n)}function g(t,n){return g=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,r){return e.__proto__=r,e},g(t,n)}function A(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function w(t,n,e){return w=A()?Reflect.construct.bind():function(r,o,s){var i=[null];i.push.apply(i,o);var a=new(Function.bind.apply(r,i));return s&&g(a,s.prototype),a},w.apply(null,arguments)}function u(t,n,e,r){n===void 0&&(n=""),r===void 0&&(r={});var o=document.createElement(t);return n&&(o.className=n),Object.keys(r).forEach(function(s){if(typeof r[s]=="function"){var i=s.indexOf("on")===0?s.substr(2).toLowerCase():s;o.addEventListener(i,r[s])}else s==="html"?o.innerHTML=r[s]:s==="text"?o.innerText=r[s]:o.setAttribute(s,r[s])}),e&&e.appendChild(o),o}function m(t){t.preventDefault(),t.stopPropagation()}var v=function(){return[].slice.call(arguments).filter(Boolean).join(" ").trim()};function d(t,n){t&&t.classList&&(Array.isArray(n)?n:[n]).forEach(function(e){t.classList.contains(e)||t.classList.add(e)})}function c(t,n){t&&t.classList&&(Array.isArray(n)?n:[n]).forEach(function(e){t.classList.contains(e)&&t.classList.remove(e)})}var y,b=13,x=40,U=38,I=[b,27,x,U,37,39],j=function(){function t(e){var r=this,o=e.handleSubmit,s=e.searchLabel,i=e.classNames,a=i===void 0?{}:i;this.container=void 0,this.form=void 0,this.input=void 0,this.handleSubmit=void 0,this.hasError=!1,this.container=u("div",v("geosearch",a.container)),this.form=u("form",["",a.form].join(" "),this.container,{autocomplete:"none",onClick:m,onDblClick:m,touchStart:m,touchEnd:m}),this.input=u("input",["glass",a.input].join(" "),this.form,{type:"text",placeholder:s||"search",onInput:this.onInput,onKeyUp:function(h){return r.onKeyUp(h)},onKeyPress:function(h){return r.onKeyPress(h)},onFocus:this.onFocus,onBlur:this.onBlur,onClick:function(){r.input.focus(),r.input.dispatchEvent(new Event("focus"))}}),this.handleSubmit=o}var n=t.prototype;return n.onFocus=function(){d(this.form,"active")},n.onBlur=function(){c(this.form,"active")},n.onSubmit=function(e){try{var r=this;return m(e),c(o=r.container,"error"),d(o,"pending"),Promise.resolve(r.handleSubmit({query:r.input.value})).then(function(){c(r.container,"pending")})}catch(s){return Promise.reject(s)}var o},n.onInput=function(){this.hasError&&(c(this.container,"error"),this.hasError=!1)},n.onKeyUp=function(e){e.keyCode===27&&(c(this.container,["pending","active"]),this.input.value="",document.body.focus(),document.body.blur())},n.onKeyPress=function(e){e.keyCode===b&&this.onSubmit(e)},n.setQuery=function(e){this.input.value=e},t}(),N=function(){function t(e){var r=this,o=e.handleClick,s=e.classNames,i=s===void 0?{}:s,a=e.notFoundMessage;this.handleClick=void 0,this.selected=-1,this.results=[],this.container=void 0,this.resultItem=void 0,this.notFoundMessage=void 0,this.onClick=function(h){if(typeof r.handleClick=="function"){var f=h.target;if(f&&r.container.contains(f)&&f.hasAttribute("data-key")){var S=Number(f.getAttribute("data-key"));r.handleClick({result:r.results[S]})}}},this.handleClick=o,this.notFoundMessage=a?u("div",v(i.notfound),void 0,{html:a}):void 0,this.container=u("div",v("results",i.resultlist)),this.container.addEventListener("click",this.onClick,!0),this.resultItem=u("div",v(i.item))}var n=t.prototype;return n.render=function(e,r){var o=this;e===void 0&&(e=[]),this.clear(),e.forEach(function(s,i){var a=o.resultItem.cloneNode(!0);a.setAttribute("data-key",""+i),a.innerHTML=r({result:s}),o.container.appendChild(a)}),e.length>0?(d(this.container.parentElement,"open"),d(this.container,"active")):this.notFoundMessage&&(this.container.appendChild(this.notFoundMessage),d(this.container.parentElement,"open")),this.results=e},n.select=function(e){return Array.from(this.container.children).forEach(function(r,o){return o===e?d(r,"active"):c(r,"active")}),this.selected=e,this.results[e]},n.count=function(){return this.results?this.results.length:0},n.clear=function(){for(this.selected=-1;this.container.lastChild;)this.container.removeChild(this.container.lastChild);c(this.container.parentElement,"open"),c(this.container,"active")},t}(),E={position:"topleft",style:"button",showMarker:!0,showPopup:!1,popupFormat:function(t){return""+t.result.label},resultFormat:function(t){return""+t.result.label},marker:{icon:l&&l.Icon?new l.Icon.Default:void 0,draggable:!1},maxMarkers:1,maxSuggestions:5,retainZoomLevel:!1,animateZoom:!0,searchLabel:"Enter address",clearSearchLabel:"Clear search",notFoundMessage:"",messageHideDelay:3e3,zoomLevel:18,classNames:{container:"leaflet-bar leaflet-control leaflet-control-geosearch",button:"leaflet-bar-part leaflet-bar-part-single",resetButton:"reset",msgbox:"leaflet-bar message",form:"",input:"",resultlist:"",item:"",notfound:"leaflet-bar-notfound"},autoComplete:!0,autoCompleteDelay:250,autoClose:!1,keepResult:!1,updateMap:!0},P="Leaflet must be loaded before instantiating the GeoSearch control",F={options:p({},E),classNames:p({},E.classNames),initialize:function(t){var n,e,r,o,s=this;if(!l)throw new Error(P);if(!t.provider)throw new Error("Provider is missing from options");this.options=p({},E,t),this.classNames=p({},this.classNames,t.classNames),this.markers=new l.FeatureGroup,this.classNames.container+=" leaflet-geosearch-"+this.options.style,this.searchElement=new j({searchLabel:this.options.searchLabel,classNames:{container:this.classNames.container,form:this.classNames.form,input:this.classNames.input},handleSubmit:function(i){return s.onSubmit(i)}}),this.button=u("a",this.classNames.button,this.searchElement.container,{title:this.options.searchLabel,href:"#",onClick:function(i){return s.onClick(i)}}),l.DomEvent.disableClickPropagation(this.button),this.resetButton=u("button",this.classNames.resetButton,this.searchElement.form,{text:"\xD7","aria-label":this.options.clearSearchLabel,onClick:function(){s.searchElement.input.value===""?s.close():s.clearResults(null,!0)}}),l.DomEvent.disableClickPropagation(this.resetButton),this.options.autoComplete&&(this.resultList=new N({handleClick:function(i){var a=i.result;s.searchElement.input.value=a.label,s.onSubmit({query:a.label,data:a})},classNames:{resultlist:this.classNames.resultlist,item:this.classNames.item,notfound:this.classNames.notfound},notFoundMessage:this.options.notFoundMessage}),this.searchElement.form.appendChild(this.resultList.container),this.searchElement.input.addEventListener("keyup",(n=function(i){return s.autoSearch(i)},(e=this.options.autoCompleteDelay)===void 0&&(e=250),r===void 0&&(r=!1),function(){var i=[].slice.call(arguments);o&&clearTimeout(o),o=setTimeout(function(){o=null,r||n.apply(void 0,i)},e),r&&!o&&n.apply(void 0,i)}),!0),this.searchElement.input.addEventListener("keydown",function(i){return s.selectResult(i)},!0),this.searchElement.input.addEventListener("keydown",function(i){return s.clearResults(i,!0)},!0)),this.searchElement.form.addEventListener("click",function(i){i.preventDefault()},!1)},onAdd:function(t){var n=this.options,e=n.showMarker,r=n.style;if(this.map=t,e&&this.markers.addTo(t),r==="bar"){var o=t.getContainer().querySelector(".leaflet-control-container");this.container=u("div","leaflet-control-geosearch leaflet-geosearch-bar"),this.container.appendChild(this.searchElement.form),o.appendChild(this.container)}return l.DomEvent.disableClickPropagation(this.searchElement.form),this.searchElement.container},onRemove:function(){var t;return(t=this.container)==null||t.remove(),this},open:function(){var t=this.searchElement,n=t.input;d(t.container,"active"),n.focus()},close:function(){c(this.searchElement.container,"active"),this.clearResults()},onClick:function(t){t.preventDefault(),t.stopPropagation(),this.searchElement.container.classList.contains("active")?this.close():this.open()},selectResult:function(t){if([b,x,U].indexOf(t.keyCode)!==-1)if(t.preventDefault(),t.keyCode!==b){var n=this.resultList.count()-1;if(!(n<0)){var e=this.resultList.selected,r=t.keyCode===x?e+1:e-1,o=this.resultList.select(r<0?n:r>n?0:r);this.searchElement.input.value=o.label}}else{var s=this.resultList.select(this.resultList.selected);this.onSubmit({query:this.searchElement.input.value,data:s})}},clearResults:function(t,n){if(n===void 0&&(n=!1),!t||t.keyCode===27){var e=this.options,r=e.autoComplete;!n&&e.keepResult||(this.searchElement.input.value="",this.markers.clearLayers()),r&&this.resultList.clear()}},autoSearch:function(t){try{var n=this;if(I.indexOf(t.keyCode)>-1)return Promise.resolve();var e=t.target.value,r=n.options.provider,o=function(){if(e.length)return Promise.resolve(r.search({query:e})).then(function(s){s=s.slice(0,n.options.maxSuggestions),n.resultList.render(s,n.options.resultFormat)});n.resultList.clear()}();return Promise.resolve(o&&o.then?o.then(function(){}):void 0)}catch(s){return Promise.reject(s)}},onSubmit:function(t){try{var n=this;return n.resultList.clear(),Promise.resolve(n.options.provider.search(t)).then(function(e){e&&e.length>0&&n.showResult(e[0],t)})}catch(e){return Promise.reject(e)}},showResult:function(t,n){var e=this.options,r=e.autoClose,o=e.updateMap,s=this.markers.getLayers();s.length>=this.options.maxMarkers&&this.markers.removeLayer(s[0]);var i=this.addMarker(t,n);o&&this.centerMap(t),this.map.fireEvent("geosearch/showlocation",{location:t,marker:i}),r&&this.closeResults()},closeResults:function(){var t=this.searchElement.container;t.classList.contains("active")&&c(t,"active"),this.clearResults()},addMarker:function(t,n){var e=this,r=this.options,o=r.marker,s=r.showPopup,i=r.popupFormat,a=new l.Marker([t.y,t.x],o),h=t.label;return typeof i=="function"&&(h=i({query:n,result:t})),a.bindPopup(h),this.markers.addLayer(a),s&&a.openPopup(),o.draggable&&a.on("dragend",function(f){e.map.fireEvent("geosearch/marker/dragend",{location:a.getLatLng(),event:f})}),a},centerMap:function(t){var n=this.options,e=n.retainZoomLevel,r=n.animateZoom,o=t.bounds?new l.LatLngBounds(t.bounds):new l.LatLng(t.y,t.x).toBounds(10),s=o.isValid()?o:this.markers.getBounds();!e&&o.isValid()&&!t.bounds||e||!o.isValid()?this.map.setView(s.getCenter(),this.getZoom(),{animate:r}):this.map.fitBounds(s,{animate:r})},getZoom:function(){var t=this.options,n=t.zoomLevel;return t.retainZoomLevel?this.map.getZoom():n}};function M(){if(!l)throw new Error(P);var t=l.Control.extend(F);return w(t,[].slice.call(arguments))}(function(t){t[t.SEARCH=0]="SEARCH",t[t.REVERSE=1]="REVERSE"})(y||(y={}));var O=function(){function t(e){e===void 0&&(e={}),this.options=void 0,this.options=e}var n=t.prototype;return n.getParamString=function(e){e===void 0&&(e={});var r=p({},this.options.params,e);return Object.keys(r).map(function(o){return encodeURIComponent(o)+"="+encodeURIComponent(r[o])}).join("&")},n.getUrl=function(e,r){return e+"?"+this.getParamString(r)},n.search=function(e){try{var r=this,o=r.endpoint({query:e.query,type:y.SEARCH});return Promise.resolve(fetch(o)).then(function(s){return Promise.resolve(s.json()).then(function(i){return r.parse({data:i})})})}catch(s){return Promise.reject(s)}},t}();var k;(function(t){t[t.INITIALIZED=0]="INITIALIZED",t[t.LOADING=1]="LOADING",t[t.SUCCESS=2]="SUCCESS",t[t.FAILURE=3]="FAILURE"})(k||(k={}));var q=function(t){function n(r){var o;r===void 0&&(r={}),(o=t.call(this,r)||this).searchUrl=void 0,o.reverseUrl=void 0;var s="https://nominatim.openstreetmap.org";return o.searchUrl=r.searchUrl||s+"/search",o.reverseUrl=r.reverseUrl||s+"/reverse",o}R(n,t);var e=n.prototype;return e.endpoint=function(r){var o=r.query,s=r.type,i=typeof o=="string"?{q:o}:o;return i.format="json",this.getUrl(s===y.REVERSE?this.reverseUrl:this.searchUrl,i)},e.parse=function(r){return(Array.isArray(r.data)?r.data:[r.data]).map(function(o){return{x:Number(o.lon),y:Number(o.lat),label:o.display_name,bounds:[[parseFloat(o.boundingbox[0]),parseFloat(o.boundingbox[2])],[parseFloat(o.boundingbox[1]),parseFloat(o.boundingbox[3])]],raw:o}})},n}(O);export{M as a,q as b};
