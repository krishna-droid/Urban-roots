import{a as c}from"./chunk-IHOIJJLM.js";import{d as h}from"./chunk-7ZC2CAVG.js";var p=h((u,l)=>{"use strict";(function(i){if(typeof define=="function"&&define.amd)define(["leaflet"],i);else if(typeof l<"u")l.exports=i(c());else{if(typeof window.L>"u")throw"Leaflet must be loaded first";i(window.L)}})(function(i){return i.Control.Search=i.Control.extend({includes:i.version[0]==="1"?i.Evented.prototype:i.Mixin.Events,options:{url:"",layer:null,sourceData:null,jsonpParam:null,propertyLoc:"loc",propertyName:"title",formatData:null,filterData:null,moveToLocation:null,buildTip:null,container:"",zoom:null,minLength:1,initial:!0,casesensitive:!1,autoType:!0,delayType:400,tooltipLimit:-1,tipAutoSubmit:!0,firstTipSubmit:!1,autoResize:!0,collapsed:!0,autoCollapse:!1,autoCollapseTime:1200,textErr:"Location not found",textCancel:"Cancel",textPlaceholder:"Search...",hideMarkerOnCollapse:!1,position:"topleft",marker:{icon:!1,animate:!0,circle:{radius:10,weight:3,color:"#e03",stroke:!0,fill:!1}}},_getPath:function(t,o){var e=o.split("."),s=e.pop(),n=e.length,r=e[0],a=1;if(n>0)for(;(t=t[r])&&a<n;)r=e[a++];if(t)return t[s]},_isObject:function(t){return Object.prototype.toString.call(t)==="[object Object]"},initialize:function(t){i.Util.setOptions(this,t||{}),this._inputMinSize=this.options.textPlaceholder?this.options.textPlaceholder.length:10,this._layer=this.options.layer||new i.LayerGroup,this._filterData=this.options.filterData||this._defaultFilterData,this._formatData=this.options.formatData||this._defaultFormatData,this._moveToLocation=this.options.moveToLocation||this._defaultMoveToLocation,this._autoTypeTmp=this.options.autoType,this._countertips=0,this._recordsCache={},this._curReq=null},onAdd:function(t){return this._map=t,this._container=i.DomUtil.create("div","leaflet-control-search"),this._input=this._createInput(this.options.textPlaceholder,"search-input"),this._tooltip=this._createTooltip("search-tooltip"),this._cancel=this._createCancel(this.options.textCancel,"search-cancel"),this._button=this._createButton(this.options.textPlaceholder,"search-button"),this._alert=this._createAlert("search-alert"),this.options.collapsed===!1&&this.expand(this.options.collapsed),this.options.marker&&(this.options.marker instanceof i.Marker||this.options.marker instanceof i.CircleMarker?this._markerSearch=this.options.marker:this._isObject(this.options.marker)&&(this._markerSearch=new i.Control.Search.Marker([0,0],this.options.marker)),this._markerSearch._isMarkerSearch=!0),this.setLayer(this._layer),t.on({resize:this._handleAutoresize},this),this._container},addTo:function(t){return this.options.container?(this._container=this.onAdd(t),this._wrapper=i.DomUtil.get(this.options.container),this._wrapper.style.position="relative",this._wrapper.appendChild(this._container)):i.Control.prototype.addTo.call(this,t),this},onRemove:function(t){this._recordsCache={},t.off({resize:this._handleAutoresize},this)},setLayer:function(t){return this._layer=t,this._layer.addTo(this._map),this},showAlert:function(t){var o=this;return t=t||this.options.textErr,this._alert.style.display="block",this._alert.innerHTML=t,clearTimeout(this.timerAlert),this.timerAlert=setTimeout(function(){o.hideAlert()},this.options.autoCollapseTime),this},hideAlert:function(){return this._alert.style.display="none",this},cancel:function(){return this._input.value="",this._handleKeypress({keyCode:8}),this._input.size=this._inputMinSize,this._input.focus(),this._cancel.style.display="none",this._hideTooltip(),this.fire("search:cancel"),this},expand:function(t){return t=typeof t=="boolean"?t:!0,this._input.style.display="block",i.DomUtil.addClass(this._container,"search-exp"),t!==!1&&(this._input.focus(),this._map.on("dragstart click",this.collapse,this)),this.fire("search:expanded"),this},collapse:function(){return this._hideTooltip(),this.cancel(),this._alert.style.display="none",this._input.blur(),this.options.collapsed&&(this._input.style.display="none",this._cancel.style.display="none",i.DomUtil.removeClass(this._container,"search-exp"),this.options.hideMarkerOnCollapse&&this._map.removeLayer(this._markerSearch),this._map.off("dragstart click",this.collapse,this)),this.fire("search:collapsed"),this},collapseDelayed:function(){var t=this;return this.options.autoCollapse?(clearTimeout(this.timerCollapse),this.timerCollapse=setTimeout(function(){t.collapse()},this.options.autoCollapseTime),this):this},collapseDelayedStop:function(){return clearTimeout(this.timerCollapse),this},_createAlert:function(t){var o=i.DomUtil.create("div",t,this._container);return o.style.display="none",i.DomEvent.on(o,"click",i.DomEvent.stop,this).on(o,"click",this.hideAlert,this),o},_createInput:function(t,o){var e=this,s=i.DomUtil.create("label",o,this._container),n=i.DomUtil.create("input",o,this._container);return n.type="text",n.size=this._inputMinSize,n.value="",n.autocomplete="off",n.autocorrect="off",n.autocapitalize="off",n.placeholder=t,n.style.display="none",n.role="search",n.id=n.role+n.type+n.size,s.htmlFor=n.id,s.style.display="none",s.value=t,i.DomEvent.disableClickPropagation(n).on(n,"keyup",this._handleKeypress,this).on(n,"paste",function(r){setTimeout(function(a){e._handleKeypress(a)},10,r)},this).on(n,"blur",this.collapseDelayed,this).on(n,"focus",this.collapseDelayedStop,this),n},_createCancel:function(t,o){var e=i.DomUtil.create("a",o,this._container);return e.href="#",e.title=t,e.style.display="none",e.innerHTML="<span>&otimes;</span>",i.DomEvent.on(e,"click",i.DomEvent.stop,this).on(e,"click",this.cancel,this),e},_createButton:function(t,o){var e=i.DomUtil.create("a",o,this._container);return e.href="#",e.title=t,i.DomEvent.on(e,"click",i.DomEvent.stop,this).on(e,"click",this._handleSubmit,this).on(e,"focus",this.collapseDelayedStop,this).on(e,"blur",this.collapseDelayed,this),e},_createTooltip:function(t){var o=this,e=i.DomUtil.create("ul",t,this._container);return e.style.display="none",i.DomEvent.disableClickPropagation(e).on(e,"blur",this.collapseDelayed,this).on(e,"wheel",function(s){o.collapseDelayedStop(),i.DomEvent.stopPropagation(s)},this).on(e,"mouseover",function(s){o.collapseDelayedStop()},this),e},_createTip:function(t,o){var e;if(this.options.buildTip){if(e=this.options.buildTip.call(this,t,o),typeof e=="string"){var s=i.DomUtil.create("div");s.innerHTML=e,e=s.firstChild}}else e=i.DomUtil.create("li",""),e.innerHTML=t;return i.DomUtil.addClass(e,"search-tip"),e._text=t,this.options.tipAutoSubmit&&i.DomEvent.disableClickPropagation(e).on(e,"click",i.DomEvent.stop,this).on(e,"click",function(n){this._input.value=t,this._handleAutoresize(),this._input.focus(),this._hideTooltip(),this._handleSubmit()},this),e},_getUrl:function(t){return typeof this.options.url=="function"?this.options.url(t):this.options.url},_defaultFilterData:function(t,o){var e,s,n,r={};if(t=t.replace(/[.*+?^${}()|[\]\\]/g,""),t==="")return[];e=this.options.initial?"^":"",s=this.options.casesensitive?void 0:"i",n=new RegExp(e+t,s);for(let a in o)n.test(a)&&(r[a]=o[a]);return r},showTooltip:function(t){if(this._countertips=0,this._tooltip.innerHTML="",this._tooltip.currentSelection=-1,this.options.tooltipLimit)for(let o in t){if(this._countertips===this.options.tooltipLimit)break;this._countertips++,this._tooltip.appendChild(this._createTip(o,t[o]))}return this._countertips>0?(this._tooltip.style.display="block",this._autoTypeTmp&&this._autoType(),this._autoTypeTmp=this.options.autoType):this._hideTooltip(),this._tooltip.scrollTop=0,this._countertips},_hideTooltip:function(){return this._tooltip.style.display="none",this._tooltip.innerHTML="",0},_defaultFormatData:function(t){var o=this,e=this.options.propertyName,s=this.options.propertyLoc,n={};if(i.Util.isArray(s))for(let r in t)n[o._getPath(t[r],e)]=i.latLng(o._getPath(t[r],s[0]),o._getPath(t[r],s[1]));else for(let r in t)n[o._getPath(t[r],e)]=i.latLng(o._getPath(t[r],s));return n},_recordsFromJsonp:function(t,o){i.Control.Search.callJsonp=o;var e=i.DomUtil.create("script","leaflet-search-jsonp",document.getElementsByTagName("body")[0]),s=i.Util.template(this._getUrl(t)+"&"+this.options.jsonpParam+"=L.Control.Search.callJsonp",{s:t});return e.type="text/javascript",e.src=s,{abort:function(){e.parentNode.removeChild(e)}}},_recordsFromAjax:function(t,o){window.XMLHttpRequest===void 0&&(window.XMLHttpRequest=function(){try{return new ActiveXObject("Microsoft.XMLHTTP.6.0")}catch{try{return new ActiveXObject("Microsoft.XMLHTTP.3.0")}catch{throw new Error("XMLHttpRequest is not supported")}}});var e=i.Browser.ie&&!window.atob&&document.querySelector,s=e?new XDomainRequest:new XMLHttpRequest,n=i.Util.template(this._getUrl(t),{s:t});return s.open("GET",n),s.onload=function(){o(JSON.parse(s.responseText))},s.onreadystatechange=function(){s.readyState===4&&s.status===200&&this.onload()},s.send(),s},_searchInLayer:function(t,o,e){var s=this,n;t instanceof i.Control.Search.Marker||(t instanceof i.Marker||t instanceof i.CircleMarker?s._getPath(t.options,e)?(n=t.getLatLng(),n.layer=t,o[s._getPath(t.options,e)]=n):s._getPath(t.feature.properties,e)&&(n=t.getLatLng(),n.layer=t,o[s._getPath(t.feature.properties,e)]=n):t instanceof i.Path||t instanceof i.Polyline||t instanceof i.Polygon?s._getPath(t.options,e)?(n=t.getBounds().getCenter(),n.layer=t,o[s._getPath(t.options,e)]=n):s._getPath(t.feature.properties,e)&&(n=t.getBounds().getCenter(),n.layer=t,o[s._getPath(t.feature.properties,e)]=n):t.hasOwnProperty("feature")?t.feature.properties.hasOwnProperty(e)&&(t.getLatLng&&typeof t.getLatLng=="function"?(n=t.getLatLng(),n.layer=t,o[t.feature.properties[e]]=n):t.getBounds&&typeof t.getBounds=="function"&&(n=t.getBounds().getCenter(),n.layer=t,o[t.feature.properties[e]]=n)):t instanceof i.LayerGroup&&t.eachLayer(function(r){s._searchInLayer(r,o,e)}))},_recordsFromLayer:function(){var t=this,o={},e=this.options.propertyName;return this._layer.eachLayer(function(s){t._searchInLayer(s,o,e)}),o},_autoType:function(){var t=this._input.value.length,o=this._tooltip.firstChild?this._tooltip.firstChild._text:"",e=o.length;if(o.indexOf(this._input.value)===0)if(this._input.value=o,this._handleAutoresize(),this._input.createTextRange){var s=this._input.createTextRange();s.collapse(!0),s.moveStart("character",t),s.moveEnd("character",e),s.select()}else this._input.setSelectionRange?this._input.setSelectionRange(t,e):this._input.selectionStart&&(this._input.selectionStart=t,this._input.selectionEnd=e)},_hideAutoType:function(){var t;if((t=this._input.selection)&&t.empty)t.empty();else if(this._input.createTextRange){t=this._input.createTextRange(),t.collapse(!0);var o=this._input.value.length;t.moveStart("character",o),t.moveEnd("character",o),t.select()}else this._input.getSelection&&this._input.getSelection().removeAllRanges(),this._input.selectionStart=this._input.selectionEnd},_handleKeypress:function(t){var o=this;switch(t.keyCode){case 27:this.collapse();break;case 13:(this._countertips==1||this.options.firstTipSubmit&&this._countertips>0)&&this._tooltip.currentSelection==-1&&this._handleArrowSelect(1),this._handleSubmit();break;case 38:this._handleArrowSelect(-1);break;case 40:this._handleArrowSelect(1);break;case 8:case 45:case 46:this._autoTypeTmp=!1;break;case 37:case 39:case 16:case 17:case 35:case 36:break;default:this._input.value.length?this._cancel.style.display="block":this._cancel.style.display="none",this._input.value.length>=this.options.minLength?(clearTimeout(this.timerKeypress),this.timerKeypress=setTimeout(function(){o._fillRecordsCache()},this.options.delayType)):this._hideTooltip()}this._handleAutoresize()},searchText:function(t){var o=t.charCodeAt(t.length);this._input.value=t,this._input.style.display="block",i.DomUtil.addClass(this._container,"search-exp"),this._autoTypeTmp=!1,this._handleKeypress({keyCode:o})},_fillRecordsCache:function(){var t=this,o=this._input.value,e;this._curReq&&this._curReq.abort&&this._curReq.abort(),i.DomUtil.addClass(this._container,"search-load"),this.options.layer?(this._recordsCache=this._recordsFromLayer(),e=this._filterData(this._input.value,this._recordsCache),this.showTooltip(e),i.DomUtil.removeClass(this._container,"search-load")):(this.options.sourceData?this._retrieveData=this.options.sourceData:this.options.url&&(this._retrieveData=this.options.jsonpParam?this._recordsFromJsonp:this._recordsFromAjax),this._curReq=this._retrieveData.call(this,o,function(s){t._recordsCache=t._formatData.call(t,s),t.options.sourceData?e=t._filterData(t._input.value,t._recordsCache):e=t._recordsCache,t.showTooltip(e),i.DomUtil.removeClass(t._container,"search-load")}))},_handleAutoresize:function(){var t;this._input.style.maxWidth!==this._map._container.offsetWidth&&(t=this._map._container.clientWidth,t-=83,this._input.style.maxWidth=t.toString()+"px"),this.options.autoResize&&this._container.offsetWidth+20<this._map._container.offsetWidth&&(this._input.size=this._input.value.length<this._inputMinSize?this._inputMinSize:this._input.value.length)},_handleArrowSelect:function(t){var o=this._tooltip.hasChildNodes()?this._tooltip.childNodes:[];for(let s=0;s<o.length;s++)i.DomUtil.removeClass(o[s],"search-tip-select");if(t==1&&this._tooltip.currentSelection>=o.length-1)i.DomUtil.addClass(o[this._tooltip.currentSelection],"search-tip-select");else if(t==-1&&this._tooltip.currentSelection<=0)this._tooltip.currentSelection=-1;else if(this._tooltip.style.display!="none"){this._tooltip.currentSelection+=t,i.DomUtil.addClass(o[this._tooltip.currentSelection],"search-tip-select"),this._input.value=o[this._tooltip.currentSelection]._text;var e=o[this._tooltip.currentSelection].offsetTop;e+o[this._tooltip.currentSelection].clientHeight>=this._tooltip.scrollTop+this._tooltip.clientHeight?this._tooltip.scrollTop=e-this._tooltip.clientHeight+o[this._tooltip.currentSelection].clientHeight:e<=this._tooltip.scrollTop&&(this._tooltip.scrollTop=e)}},_handleSubmit:function(){if(this._hideAutoType(),this.hideAlert(),this._hideTooltip(),this._input.style.display=="none")this.expand();else if(this._input.value==="")this.collapse();else{var t=this._getLocation(this._input.value);t?(this.showLocation(t,this._input.value),this.fire("search:locationfound",{latlng:t,text:this._input.value,layer:t.layer?t.layer:null})):this.showAlert()}},_getLocation:function(t){return this._recordsCache.hasOwnProperty(t)?this._recordsCache[t]:!1},_defaultMoveToLocation:function(t,o,e){this.options.zoom?this._map.setView(t,this.options.zoom):this._map.panTo(t)},showLocation:function(t,o){var e=this;return e._map.once("moveend zoomend",function(s){e._markerSearch&&e._markerSearch.addTo(e._map).setLatLng(t)}),e._moveToLocation(t,o,e._map),e.options.autoCollapse&&e.collapse(),e}}),i.Control.Search.Marker=i.Marker.extend({includes:i.version[0]==="1"?i.Evented.prototype:i.Mixin.Events,options:{icon:new i.Icon.Default,animate:!0,circle:{radius:10,weight:3,color:"#e03",stroke:!0,fill:!1}},initialize:function(t,o){i.setOptions(this,o),o.icon===!0&&(o.icon=new i.Icon.Default),i.Marker.prototype.initialize.call(this,t,o),i.Control.Search.prototype._isObject(this.options.circle)&&(this._circleLoc=new i.CircleMarker(t,this.options.circle))},onAdd:function(t){i.Marker.prototype.onAdd.call(this,t),this._circleLoc&&(t.addLayer(this._circleLoc),this.options.animate&&this.animate())},onRemove:function(t){i.Marker.prototype.onRemove.call(this,t),this._circleLoc&&t.removeLayer(this._circleLoc)},setLatLng:function(t){return i.Marker.prototype.setLatLng.call(this,t),this._circleLoc&&this._circleLoc.setLatLng(t),this},_initIcon:function(){this.options.icon&&i.Marker.prototype._initIcon.call(this)},_removeIcon:function(){this.options.icon&&i.Marker.prototype._removeIcon.call(this)},animate:function(){if(this._circleLoc){var t=this._circleLoc,o=200,e=5,s=parseInt(t._radius/e),n=this.options.circle.radius,r=t._radius*2,a=0;t._timerAnimLoc=setInterval(function(){a+=.5,s+=a,r-=s,t.setRadius(r),r<n&&(clearInterval(t._timerAnimLoc),t.setRadius(n))},o)}return this}}),i.Map.addInitHook(function(){this.options.searchControl&&(this.searchControl=i.control.search(this.options.searchControl),this.addControl(this.searchControl))}),i.control.search=function(t){return new i.Control.Search(t)},i.Control.Search})});export{p as a};
